{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte",
    "../../Legend.svelte",
    "../../Viz.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import Viz from './components/Viz.svelte';\n</script>\n\n<div class=\"wrapper\">\n  <h1>SciLifeLab Publications</h1>\n  <h2>Number of papers in SciLifeLab's TOP10 journals.</h2>\n  <Viz />\n  <footer><a href=\"https://higsch.com\">higsch | data & design, 2020</a></footer>\n</div>\n\n<style>\n  .wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: 100%;\n  }\n\n  h1 {\n    font-family: 'Cormorant Upright', serif;\n    font-size: 3rem;\n    color: slategrey;\n  }\n\n  h2 {\n    font-family: 'Cormorant Upright', serif;\n    font-size: 1.3rem;\n    color: rgb(144, 147, 148);\n  }\n\n  footer {\n    margin: 2rem 0 0 0;\n    font-family: 'Cormorant Upright', serif;\n    font-size: 1rem;\n  }\n\n  footer a {\n    text-decoration: none;\n    color: slategrey;\n    transition: color 0.2s ease;\n  }\n\n  footer a:hover {\n    color: #fb8072;\n  }\n</style>\n",
    "<script>\n  export let journals = [];\n</script>\n\n<ul class=\"legend\">\n  {#each journals as journal}\n    <li>\n      <div class=\"color-square\" style=\"background-color: {journal.color};\"></div>\n      <p>{journal.name}</p>\n    </li>\n  {/each}\n</ul>\n\n<style>\n  .legend {\n    display: flex;\n    justify-content: center;\n    width: 100%;\n    height: 5%;\n    list-style-type: none;\n  }\n\n  .legend li {\n    display: flex;\n    align-items: center;\n    margin: 0 0.5rem;\n  }\n\n  .color-square {\n    width: 1rem;\n    height: 1rem;\n    border-radius: 2px;\n  }\n\n  p {\n    margin: 0 0 0 0.3rem;\n    font-family: Verdana, sans-serif;\n    font-size: 0.8rem;\n  }\n</style>\n",
    "<script>\n  import * as d3 from 'd3';\n  import journals from './journals';\n\n  import Legend from './Legend.svelte';\n\n  let viz, tooltip;\n\n  // read in the data\n  d3.csv('/data/scilifelab-publications.csv', (d) => ({\n    issn: d.ISSN,\n    journal: d.Journal,\n    year: +d.Published.split('-')[0]\n  })).then((data) => {\n    // filter for wanted journals\n    const dataFiltered = data\n      .filter((d) => journals.map((j) => j.issn).includes(d.issn));\n    \n    // nest and summarise\n    const dataNested = d3.nest()\n      .key((d) => d.year)\n      .rollup((values) => journals.map((j) => ({\n        [j.issn]: values.filter((d) => d.issn === j.issn).length\n      })))\n      .entries(dataFiltered)\n      .map((d) => Object.assign({year: +d.key}, d.value.reduce((acc, cur) => (Object.assign(acc, cur)))));\n\n    // now create the visual\n    createViz(dataNested);\n  });\n\n  // create the viz\n  function createViz(data) {\n    const { width, height } = viz.getBoundingClientRect();\n    const margin = {\n      v: 50,\n      h: 50\n    };\n\n    const d3Tooltip = d3.select(tooltip);\n    d3Tooltip.style('opacity', 0);\n\n    // remove old elements\n    d3.select(viz).selectAll('*').remove();\n\n    // x scale\n    const xScale = d3.scaleLinear()\n      .domain(d3.extent(data.map((d) => +d.year)))\n      .range([margin.h, width - margin.h]);\n\n    // console.log(journalRanks)\n\n    // stack layout\n    const steam = d3.stack()\n      .offset(d3.stackOffsetSilhouette)\n      .keys(journals.map((j) => j.issn))\n      (data);\n\n    // calculate ranks and ranges based on years\n    const ranks = data.map((d, yearIndex) => {\n      const { year, ...vals } = d;\n      const num = Object.values(vals).map((d, i) => ({issn: Object.keys(vals)[i], num: d}));\n      const sortedNum = [...num].sort((a, b) => a.num - b.num);\n      const ranks = sortedNum.map((d, i) => ({\n        ...d,\n        year,\n        rank: i,\n        coords: steam.find((s) => s.key === d.issn)[yearIndex]\n      }));\n      return({\n        range: d3.extent(ranks.map((r) => r.coords).flat()),\n        values: ranks\n      });\n    });\n\n    // recalculate coordinates based on ranks and ranges\n    ranks.forEach((d) => {\n      const { range, values } = d;\n      const rankRange = d3.range(values.length);\n      rankRange.forEach((r, i) => {\n        const point = values.find((v) => v.rank === r);\n        const previousEndCoord = i > 0 ? values[i - 1].bumpCoords[1] : range[0];\n        const bumpCoords = [previousEndCoord, previousEndCoord + point.num];\n        point.bumpCoords = bumpCoords;\n      });\n    });\n\n    const updatedSteam = [...steam];\n    updatedSteam.forEach((d) => {\n      let { key, index, ...coords } = d;\n      const updated = ranks.map((d) => d.values).flat().filter((d) => d.issn === key);\n      Object.values(coords).forEach((d) => {\n        const updatedCoords = updated.find((c) => c.year === d.data.year);\n        d[0] = updatedCoords.bumpCoords[0];\n        d[1] = updatedCoords.bumpCoords[1];\n      });\n    });\n\n    // y scale\n    const allYValues = updatedSteam.map((d) => d.map((d) => [d[0], d[1]])).flat(2);\n                        \n    const yScale = d3.scaleLinear()\n      .domain(d3.extent(allYValues))\n      .range([height - margin.v, margin.v]);\n\n    // path generator for the areas\n    const stackArea = d3.area()\n      .x(d => xScale(d.data.year))\n      .y0(d => yScale(d[0]))\n      .y1(d => yScale(d[1]))\n      .curve(d3.curveCardinal.tension(0));\n    \n    // create svg\n    const svg = d3.select(viz).append('svg')\n      .attr('width', width)\n      .attr('height', height);\n\n    svg.selectAll('path')\n      .data(updatedSteam)\n      .join('path')\n      .attr('fill', (d) => journals.find((j) => j.issn === d.key).color)\n      .attr('fill-opacity', 0.8)\n      .attr('d', stackArea)\n      .on('mousemove', function (d) {\n        d3.select(this).transition()\n          .duration(100)\n          .style('fill-opacity', 1);\n        d3Tooltip.transition()\n          .duration(100)\n          .style('opacity', 0.9);\n        d3Tooltip\n          .html(journals.find((j) => j.issn === d.key).name)\n          .style('left', (d3.event.pageX) + 'px')\n          .style('top', (d3.event.pageY - 28) + 'px');\n      })\n      .on('mouseout', function (d) {\n        d3.select(this).transition()\n          .duration(100)\n          .style('fill-opacity', 0.8);\n        d3Tooltip.transition()\n          .duration(100)\n          .style('opacity', 0);\n        });;\n\n    // add the x axis\n    const xAxis = (g) => g\n      .attr('transform', `translate(0,${height - margin.v + 5})`)\n      .call(d3.axisBottom(xScale).ticks().tickSizeOuter(0).tickFormat(d3.format('')))\n\n    svg.append('g')\n      .call(xAxis)\n      .selectAll('text')\n      .style('text-anchor', 'middle');\n  }\n</script>\n\n<div class=\"tooltip\" bind:this={tooltip}></div>\n<div id=\"viz\" bind:this={viz}></div>\n<Legend {journals} />\n\n<style>\n  #viz {\n    width: 100%;\n    height: 50%;\n    margin: 1rem 0;\n  }\n\n  .tooltip {\n    position: absolute;\n    text-align: center;\n    /* width: 60px; */\n    /* height: 28px; */\n    padding: 0.3rem;\n    font: 12px sans-serif;\n    background: silver;\n    border: 0px;\n    border-radius: 2px;\n    pointer-events: none;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "AAYE,QAAQ,4BAAC,CAAC,AACR,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,WAAW,CAAE,MAAM,CACnB,eAAe,CAAE,MAAM,CACvB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,AACd,CAAC,AAED,EAAE,4BAAC,CAAC,AACF,WAAW,CAAE,mBAAmB,CAAC,CAAC,KAAK,CACvC,SAAS,CAAE,IAAI,CACf,KAAK,CAAE,SAAS,AAClB,CAAC,AAED,EAAE,4BAAC,CAAC,AACF,WAAW,CAAE,mBAAmB,CAAC,CAAC,KAAK,CACvC,SAAS,CAAE,MAAM,CACjB,KAAK,CAAE,IAAI,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,AAC3B,CAAC,AAED,MAAM,4BAAC,CAAC,AACN,MAAM,CAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAClB,WAAW,CAAE,mBAAmB,CAAC,CAAC,KAAK,CACvC,SAAS,CAAE,IAAI,AACjB,CAAC,AAED,oBAAM,CAAC,CAAC,cAAC,CAAC,AACR,eAAe,CAAE,IAAI,CACrB,KAAK,CAAE,SAAS,CAChB,UAAU,CAAE,KAAK,CAAC,IAAI,CAAC,IAAI,AAC7B,CAAC,AAED,oBAAM,CAAC,eAAC,MAAM,AAAC,CAAC,AACd,KAAK,CAAE,OAAO,AAChB,CAAC;ACjCD,OAAO,4BAAC,CAAC,AACP,OAAO,CAAE,IAAI,CACb,eAAe,CAAE,MAAM,CACvB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,EAAE,CACV,eAAe,CAAE,IAAI,AACvB,CAAC,AAED,qBAAO,CAAC,EAAE,cAAC,CAAC,AACV,OAAO,CAAE,IAAI,CACb,WAAW,CAAE,MAAM,CACnB,MAAM,CAAE,CAAC,CAAC,MAAM,AAClB,CAAC,AAED,aAAa,4BAAC,CAAC,AACb,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,CACZ,aAAa,CAAE,GAAG,AACpB,CAAC,AAED,CAAC,4BAAC,CAAC,AACD,MAAM,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CACpB,WAAW,CAAE,OAAO,CAAC,CAAC,UAAU,CAChC,SAAS,CAAE,MAAM,AACnB,CAAC;AC2HD,IAAI,cAAC,CAAC,AACJ,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,GAAG,CACX,MAAM,CAAE,IAAI,CAAC,CAAC,AAChB,CAAC,AAED,QAAQ,cAAC,CAAC,AACR,QAAQ,CAAE,QAAQ,CAClB,UAAU,CAAE,MAAM,CAGlB,OAAO,CAAE,MAAM,CACf,IAAI,CAAE,IAAI,CAAC,UAAU,CACrB,UAAU,CAAE,MAAM,CAClB,MAAM,CAAE,GAAG,CACX,aAAa,CAAE,GAAG,CAClB,cAAc,CAAE,IAAI,AACtB,CAAC"
}